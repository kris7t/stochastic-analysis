
\documentclass[a4paper,11pt,twoside,openright]{memoir}

\renewcommand*{\baselinestretch}{1.15}
\setbinding{2mm}
\isopage
%% Page layout by Andreas Mathias from memman.pdf
% \setlength{\trimtop}{0pt}
% \setlength{\trimedge}{\stockwidth}
% \addtolength{\trimedge}{-\paperwidth}
% \settypeblocksize{634pt}{448.13pt}{*}
% \setulmargins{4cm}{*}{*}
% \setlrmargins{*}{*}{1.5}
% \setmarginnotes{17pt}{51pt}{\onelineskip}
% \setheadfoot{\onelineskip}{2\onelineskip}
% \setheaderspaces{*}{2\onelineskip}{*}
\checkandfixthelayout

%% Avoid widows and orphans
%\clubpenalty=10000
%\widowpenalty=10000
%\raggedbottom

\usepackage[usenames,dvipsnames]{xcolor}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{XCharter}
\usepackage[scaled]{helvet}
%\usepackage{berasans}
\usepackage{beramono}
\usepackage[expert,bitstream-charter,
greekuppercase=italicized,greeklowercase=italicized]{mathdesign}

%% https://groups.google.com/d/msg/comp.text.tex/XULGbUPl5hs/ffvt5EkzpyoJ
\DeclareSymbolFont{xyz}{U}{txmia}{m}{it}
\SetSymbolFont{xyz}{bold}{U}{txmia}{bx}{it}
\DeclareSymbolFontAlphabet{\varmathbb}{xyz}
\makeatletter
\DeclareMathSymbol{\m@thbbch@rA}{\mathord}{xyz}{129}
\DeclareMathSymbol{\m@thbbch@rB}{\mathord}{xyz}{130}
\DeclareMathSymbol{\m@thbbch@rC}{\mathord}{xyz}{131}
\DeclareMathSymbol{\m@thbbch@rD}{\mathord}{xyz}{132}
\DeclareMathSymbol{\m@thbbch@rE}{\mathord}{xyz}{133}
\DeclareMathSymbol{\m@thbbch@rF}{\mathord}{xyz}{134}
\DeclareMathSymbol{\m@thbbch@rG}{\mathord}{xyz}{135}
\DeclareMathSymbol{\m@thbbch@rH}{\mathord}{xyz}{136}
\DeclareMathSymbol{\m@thbbch@rI}{\mathord}{xyz}{137}
\DeclareMathSymbol{\m@thbbch@rJ}{\mathord}{xyz}{138}
\DeclareMathSymbol{\m@thbbch@rK}{\mathord}{xyz}{139}
\DeclareMathSymbol{\m@thbbch@rL}{\mathord}{xyz}{140}
\DeclareMathSymbol{\m@thbbch@rM}{\mathord}{xyz}{141}
\DeclareMathSymbol{\m@thbbch@rN}{\mathord}{xyz}{142}
\DeclareMathSymbol{\m@thbbch@rO}{\mathord}{xyz}{143}
\DeclareMathSymbol{\m@thbbch@rP}{\mathord}{xyz}{144}
\DeclareMathSymbol{\m@thbbch@rQ}{\mathord}{xyz}{145}
\DeclareMathSymbol{\m@thbbch@rR}{\mathord}{xyz}{146}
\DeclareMathSymbol{\m@thbbch@rS}{\mathord}{xyz}{147}
\DeclareMathSymbol{\m@thbbch@rT}{\mathord}{xyz}{148}
\DeclareMathSymbol{\m@thbbch@rU}{\mathord}{xyz}{149}
\DeclareMathSymbol{\m@thbbch@rV}{\mathord}{xyz}{150}
\DeclareMathSymbol{\m@thbbch@rW}{\mathord}{xyz}{151}
\DeclareMathSymbol{\m@thbbch@rX}{\mathord}{xyz}{152}
\DeclareMathSymbol{\m@thbbch@rY}{\mathord}{xyz}{153}
\DeclareMathSymbol{\m@thbbch@rZ}{\mathord}{xyz}{154}
\DeclareMathSymbol{\varBbbk}{\mathord}{xyz}{171}
\long\def\DoLongFutureLet #1#2#3#4{%
  \def\@FutureLetDecide{#1#2\@FutureLetToken
    \def\@FutureLetNext{#3}\else
    \def\@FutureLetNext{#4}\fi\@FutureLetNext}
  \futurelet\@FutureLetToken\@FutureLetDecide}
\def\DoFutureLet #1#2#3#4{\DoLongFutureLet{#1}{#2}{#3}{#4}}
\def\@EachCharacter{\DoFutureLet{\ifx}{\@EndEachCharacter}%
  {\@EachCharacterDone}{\@PickUpTheCharacter}}
\def\m@keCharacter#1{\csname\F@ntPrefix#1\endcsname}
\def\@PickUpTheCharacter#1{\m@keCharacter{#1}\@EachCharacter}
\def\@EachCharacterDone \@EndEachCharacter{}
\DeclareRobustCommand*{\varmathbb}[1]{\gdef\F@ntPrefix{m@thbbch@r}%
  \@EachCharacter #1\@EndEachCharacter}
\makeatother
\let\mathbb\varmathbb

\setsecheadstyle{\Large\sffamily\bfseries}
\setsubsecheadstyle{\large\sffamily\bfseries}
\setsubsubsecheadstyle{\normalsize\sffamily\bfseries}
\setparaheadstyle{\normalsize\sffamily\bfseries}
\setsubparaheadstyle{\normalsize\sffamily\bfseries}

\copypagestyle{my}{ruled}
\makeevenhead{my}{\thepage}{\itshape\textls{\MakeUppercase{\leftmark}}}{}
\makeoddhead{my}{}{\itshape\rightmark}{\thepage}
\makeevenfoot{my}{}{}{}
\makeoddfoot{my}{}{}{}
\makeatletter
\makepsmarks{my}{%
  \def\chaptermark##1{%
    \markboth{##1}{}}%
  \def\sectionmark##1{%
    \markright{%
      \ifnum\c@secnumdepth > \z@
      \thesection. \ %
      \fi
      ##1}}}
\makeatother
\pagestyle{my}

\renewcommand*{\chapnamefont}{\normalfont\huge\textit}
\renewcommand*{\chapnumfont}{\normalfont\huge\textit}
\renewcommand*{\chaptitlefont}{\normalfont\Huge\sffamily\bfseries}
\renewcommand*{\cftchapterfont}{\normalfont\sffamily\bfseries\large}
\renewcommand*{\cftchapterpagefont}{\normalfont\sffamily\bfseries\large}

\setsecnumdepth{subsection}
\settocdepth{subsection}

\renewcommand*{\pfbreakdisplay}{\ensuremath{\bullet\quad\bullet\quad\bullet}}
\newcommand*{\fbreak}{\fancybreak{\pfbreakdisplay}}

\usepackage{array,booktabs,mdwlist}
\renewcommand*{\arraystretch}{1.2}
\usepackage{xspace}

\usepackage{amsmath,relsize,stackengine,mleftright,mathtools}
\allowdisplaybreaks
\usepackage[ntheorem]{empheq}
\usepackage{upgreek}
\usepackage{nicefrac}

%% http://tex.stackexchange.com/a/100151/8744
\makeatletter
\def\tagform@#1{\maketag@@@{\small(#1)\@@italiccorr}}
\makeatother

\newcommand*{\mathabbrev}[1]{\textit{\textls[45]{#1}}}
\DeclareMathOperator{\E}{\mathbb{E}}
\newcommand*{\PN}{\mathabbrev{PN}}
\newcommand*{\SPN}{\mathabbrev{SPN}}
\newcommand*{\GSPN}{\mathabbrev{GSPN}}
\newcommand*{\SGSPN}{\mathabbrev{SGSPN}}
\newcommand*{\TL}{\mathabbrev{TL}}
\newcommand*{\TS}{\mathabbrev{TS}}
\newcommand*{\LN}{\mathabbrev{LN}}
\newcommand*{\HN}{\mathabbrev{HN}}
\newcommand*{\EN}{\mathabbrev{EN}}
\newcommand*{\PI}{\mathabbrev{PI}}
\newcommand*{\xto}{}\let\xto\xrightarrow
\newcommand*{\vecarrow}{}\let\vecarrow\vec
\renewcommand*{\vec}[1]{\boldsymbol{\mathrm{#1}}}
\newcommand*{\EffC}[1]{\mathop{\textnormal{EC}\mathnormal{(#1)}}}
\DeclareMathOperator{\EME}{EME}
\DeclareMathOperator{\SME}{SME}
\DeclareMathOperator{\PriME}{\Pi ME}
\DeclareMathOperator{\HME}{HME}
\DeclareMathOperator{\MME}{MME}
\newcommand*{\MInv}[1]{\tau\vec{#1}}
\DeclareMathOperator{\StrC}{SC}
\DeclareMathOperator{\CasC}{CC}
\DeclareMathOperator{\SCC}{SCC}
\newcommand*{\CCS}{\mathabbrev{CCS}}
\newcommand*{\ECS}{\mathabbrev{ECS}}
\newcommand*{\RS}{\mathabbrev{RS}}
\newcommand*{\TRS}{\mathabbrev{TRS}}
\newcommand*{\PS}{\mathabbrev{PS}}
\newcommand*{\PSS}{\mathabbrev{PSS}}
\newcommand*{\lS}[1]{S^{(#1)}}
\newcommand*{\macroS}{}\let\macroS\tilde
\newcommand*{\macroStates}{}\let\macroStates\widetilde
\newcommand*{\macroTRS}{\macroStates{\TRS}}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\level}{level}
\DeclareMathOperator{\Env}{Env}
\DeclareMathOperator{\Above}{Above}
\DeclareMathOperator{\Bag}{Bag}
\newcommand*{\To}{\textbf{to}\xspace}
\DeclareMathOperator{\dirplus}{\mathbin{\overline{\oplus}}}
\newcommand*{\leftTok}[1]{{}^\bullet #1}
\newcommand*{\leftInh}[1]{{}^\circ #1}
\newcommand*{\rightTok}[1]{#1{}^\bullet}
\newcommand*{\rightInh}[1]{#1{}^\circ}
\newcommand*{\sumprime}{\sideset{}{'}\sum}

\newcommand*{\loc}[1]{^{(#1)}}

%% http://tex.stackexchange.com/a/13035/8744
\newcommand*{\textabbrev}[1]{\textls[35]{\textsc{#1}}}
\newcommand*{\Ctmc}{\textabbrev{Ctmc}}
\newcommand*{\ctmc}{\textabbrev{ctmc}}
\newcommand*{\Gspn}{\textabbrev{Gspn}}
\newcommand*{\gspn}{\textabbrev{gspn}}
\newcommand*{\Spn}{\textabbrev{Spn}}
\newcommand*{\spn}{\textabbrev{spn}}
\newcommand*{\Sgspn}{\textabbrev{Sgspn}}
\newcommand*{\sgspn}{\textabbrev{sgspn}}
\newcommand{\paren}[1]{\textup(#1\textup)}

\usepackage{xparse}

\usepackage[final]{microtype}

\usepackage{tikz}
\usetikzlibrary{arrows.meta,calc,positioning,shapes,matrix}
\usepackage{tikz-timing}
\usepackage[compactlambda]{petriTikz}

\pgfdeclarelayer{bg}
\pgfdeclarelayer{connections}
\pgfsetlayers{bg,connections,main}

\usepackage{varioref}
\renewcommand*{\reftextfacebefore}{}
\renewcommand*{\reftextfaceafter}{}

\usepackage[
  hyperfootnotes=false,
  breaklinks=true,
  hypertexnames=false,
  plainpages=false,
  pdfpagelabels=true,
  hidelinks
]{hyperref}

\let\openbox\relax
\usepackage[amsmath,thmmarks,hyperref]{ntheorem}
\theoremheaderfont{\normalfont\sffamily\bfseries}
\makeatletter
% Lifted from ntheorem.sty
\newcounter{proof}
\newcounter{currproofctr}
\newcounter{endproofctr}
\newcommand*{\openbox}{\leavevmode
  \hbox to.77778em{%
    \hfil\vrule
  \vbox to.675em{\hrule width.6em\vfil\hrule}%
  \vrule\hfil}}
\gdef\proofSymbol{\openbox}
\newcommand{\proofname}{Proof}
\newenvironment{proof}[1][\proofname]{%
  \th@nonumberplain
  \def\theorem@headerfont{\itshape}%
  \normalfont
  \theoremsymbol{\ensuremath{_\blacksquare}}%
  \@thm{proof}{proof}{#1.}%
}{\@endtheorem}
\newtheoremstyle{my}%
{\item[\hskip\labelsep \theorem@headerfont ##1~##2\theorem@separator]}%
{\item[\hskip\labelsep {\theorem@headerfont ##1~##2} \paren{##3}\theorem@separator]}
\makeatother
\theoremstyle{my}
\theoremseparator{.}

\usepackage[capitalise,noabbrev]{cleveref}
\crefname{section}{\S}{\SS}
% Protect pages and equations from capitalization
\crefname{page}{{p}age}{{p}ages}
\crefname{equation}{{e}q.}{{e}qs.}

\makeatletter
\DeclareRobustCommand{\labelvref}{\cref@vref{labelcref}}
\DeclareRobustCommand{\labelfullref}{\cref@fullref{labelcref}}
\makeatother

\newtheorem{thm}{Theorem}[chapter]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{restr}[thm]{Restriction}
\newtheorem{obs}[thm]{Observation}

\usepackage{autonum}
% Patch varioref commands for autonum
\makeatletter
\autonum@generatePatchedReferenceCSL{Cref}
\autonum@generatePatchedReferenceCSL{labelcref}
\autonum@generatePatchedReferenceCSL{vref}
\autonum@generatePatchedReferenceCSL{Vref}
\autonum@generatePatchedReferenceCSL{labelvref}
\autonum@generatePatchedReferenceCSL{fullref}
\autonum@generatePatchedReferenceCSL{Fullref}
\autonum@generatePatchedReferenceCSL{labelfullref}
\makeatother

\renewcommand*{\reftextfaraway}[1]{on~\cpageref{#1}}

\usepackage{algorithm,algpseudocode}
\makeatletter
\@addtoreset{algorithm}{chapter}
\makeatother
\renewcommand{\thealgorithm}{\thechapter.\arabic{algorithm}} 

\usepackage[
  style=authoryear-comp,
  maxnames=2,
  maxbibnames=99,
  uniquename=init,
  uniquelist=false,
  backref=false,
  doi=true,
  isbn=true,
  eprint=true,
  natbib=true,
  hyperref=true,
  autolang=hyphen,
  backend=biber
]{biblatex}
\bibliography{markov}
\AtEveryBibitem{% Clean up the bibtex rather than editing it
  \clearlist{address}
  \clearfield{date}
  \clearlist{location}
  \clearfield{month}
  \ifentrytype{book}{}{% Remove editor except for books
    \ifentrytype{inbook}{}{
      \clearname{editor}
    }
  }
  \iffieldundef{doi}{}{
    \clearfield{url}
    \clearfield{isbn}
    \clearfield{issn}
    \clearfield{eprint}
  }
  \iffieldundef{eprint}{}{
    \clearfield{url}
    \clearfield{isbn}
    \clearfield{issn}
  }
  %  \clearfield{url}}{}
}
\DefineBibliographyStrings{english}{%
  bibliography = {References}
}
\renewcommand*{\bibopenparen}{\textup(}
\renewcommand*{\bibcloseparen}{\textup)}

\begin{document}

\frontmatter

\include{titlepage-onlab}

\begin{KeepFromToc}
  \tableofcontents
\end{KeepFromToc}

\mainmatter

\include{intro}

\include{kronecker}

\backmatter

\printbibliography

\end{document}